import{useReducer as r,useState as t,useEffect as e}from"react";import s,{Hub as a,Auth as n}from"aws-amplify";const o=(r,t)=>{switch(t.type){case"FETCH_USER_DATA_INIT":return{...r,isLoading:!0,isError:!1};case"FETCH_USER_DATA_SUCCESS":return{...r,isLoading:!1,isError:!1,user:t.payload.user};case"FETCH_USER_DATA_FAILURE":return{...r,isLoading:!1,isError:!0};case"RESET_USER_DATA":return{...r,user:null};default:throw new Error}};export default i=>{s.configure(i);const[E,u]=r(o,{isLoading:!0,isError:!1,user:null}),[c,_]=t(!1);e(()=>{let r=!0;return a.listen("auth",t=>{const{payload:e}=t;(t=>{switch(t.event){case"signIn":r&&_(!0)}})(e)}),(async()=>{r&&u({type:"FETCH_USER_DATA_INIT"});try{if(r){const r=await n.currentAuthenticatedUser();r&&u({type:"FETCH_USER_DATA_SUCCESS",payload:{user:r}})}}catch(t){r&&u({type:"FETCH_USER_DATA_FAILURE"})}})(),()=>{a.remove("auth"),r=!1}},[c]);return{state:E,handleSignout:async()=>{try{await n.signOut(),_(!1),u({type:"RESET_USER_DATA"})}catch(r){console.error("Error signing out user ",r)}}}};
